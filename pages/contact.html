<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø·ÙÙ„ ÙˆØ§Ù…Ø±Ø£Ø©</title>
    <link rel="stylesheet" href="contact-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<header>
    <a href="./loader.html" class="logo">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø·ÙÙ„ ÙˆØ§Ù…Ø±Ø£Ø©</a>
    <div class="dropdown" onclick="toggleDropdown()">â˜°</div>
    <nav>
        <a href="./loader.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="about.html">Ù…Ù† Ù†Ø­Ù†</a>
        <a href="programs.html">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</a>
        <a href="events.html">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</a>
        <a href="resources.html">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</a>
        <a href="contact.html">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
    </nav>
</header>

<main>
    <section class="contact-info">
        <h1>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h1>
        <p>Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©! Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ø³Ø¤Ø§Ù„ØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§.</p>
        <div class="contact-details">
            <div class="contact-item">
                <h2>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†</h2>
                <p>ğŸ“± 0569451267 </p>
                <p><i class="fa fa-whatsapp" style="font-size:24px;color: #9cf19c"></i> ÙˆØ§ØªØ³ Ø¢Ø¨: <a href="https://wa.me/+972569451267" target="_blank">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³ Ø¢Ø¨</a></p>
                <p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: <a href="mailto:abdalrhmanaljamal89@gmail.com">abdalrhmanaljamal89@gmail.com</a></p>
                <p>Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ø®Ù„ÙŠÙ„</p>
            </div>
            <div class="contact-item">
                <h2>Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
                <p>ğŸ“± 0594380216</p>
                <p><i class="fa fa-whatsapp" style="font-size:24px;color: #9cf19c"></i> ÙˆØ§ØªØ³ Ø¢Ø¨: <a href="https://wa.me/+97259438021" target="_blank">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³ Ø¢Ø¨</a></p>
                <p>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: <a href="mailto:w8900661@gmail.com">w8900661@gmail.com</a></p>
                <p>Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ù†Ø§Ø¨Ù„Ø³</p>
            </div>
        </div>
    </section>

    <section class="contact-form">
        <h2>Ø£Ø±Ø³Ù„ Ù„Ù†Ø§ Ø±Ø³Ø§Ù„Ø©</h2>
        <form action="#" method="POST">
            <textarea name="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." required></textarea>
            <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
        </form>
    </section>
</main>
<section class="messages-container">
    <h2>Ø±Ø³Ø§Ø¦Ù„Ùƒ</h2>
    <div id="messages-list"></div>
</section>





<footer>
    <p>&copy; 2025 Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø·ÙÙ„ ÙˆØ§Ù…Ø±Ø£Ø© | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const userId = document.cookie.split('; ').find(row => row.startsWith('userId='))?.split('=')[1];
        if (!userId) {
            alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
            return;
        }

        try {
            const response = await fetch(`https://academic-server.onrender.com/users/${userId}`);
            const data = await response.json();

            if (data && data.messages) {
                displayMessages(data.messages);
            } else {
                alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„.");
            }
        } catch (error) {
            console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        }
    });

    function displayMessages(messages) {
        const messagesList = document.getElementById("messages-list");
        messagesList.innerHTML = "";

        if (!messages.length) {
            messagesList.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù…ØªØ§Ø­Ø©.</p>";
            return;
        }

        messages.forEach(msg => {
   if(msg.senderid<0){
       const card = document.createElement("div");
       card.classList.add("message-card");

       const messageWrapper = document.createElement("div");
       messageWrapper.classList.add("message-wrapper");


           messageWrapper.style.textAlign = "left";   // Align messages from the user to the left
           messageWrapper.style.direction = "ltr";    // Left-to-right direction


       messageWrapper.innerHTML = `<p>${msg.msg}</p>`;
       card.appendChild(messageWrapper);
       messagesList.appendChild(card);
   }else{

           const card = document.createElement("div");
           card.classList.add("message-card");

           const messageWrapper = document.createElement("div");
           messageWrapper.classList.add("message-wrapper");




           messageWrapper.innerHTML = `<p>${msg.msg}</p>`;
           card.appendChild(messageWrapper);
           messagesList.appendChild(card);


   }
        });

    }
    document.querySelector(".contact-form form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const userId = document.cookie.split("; ").find(row => row.startsWith("userId="))?.split("=")[1];
        if (!userId) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");

        const message = document.querySelector('textarea[name="message"]').value;

        const response = await fetch(`https://academic-server.onrender.com/users/${userId}/messages`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ senderid: userId, msg: message })
        });

        const result = await response.json();



        try {
            const response = await fetch(`https://academic-server.onrender.com/users/${userId}`);
            const data = await response.json();

            if (data && data.messages) {
                displayMessages(data.messages);
            } else {
                alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„.");
            }
        } catch (error) {
            console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        }
        alert(result.message || result.error);
    });

    function toggleDropdown() {
        const nav = document.querySelector('nav');
        nav.classList.toggle('active');
    }
</script>
</body>
</html>
